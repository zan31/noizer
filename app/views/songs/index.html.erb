<% @songs.each do |song| %>
  <div id="postcard" class="card">
  <div class="card-header">
    <% if song.user.image.url %> 
      <%= image_tag song.user.image.url, class:"avatar" %>
      <%if user_signed_in? %>
      <% if(current_user.id == song.user.id)%> 
        <td><%= link_to 'Edit', edit_song_path(song), class:"btn btn-primary" %></td>
        <td><%= link_to 'Delete', song, method: :delete, data: { confirm: 'Are you sure?' }, class:"btn btn-danger" %></td>
        <%end%> 
        <%end%> 
    <% else %>
    <%= image_tag "avatar.png", class:"avatar" %>
    <%end%> 
  </div>
   <div class="row g-0">
    <div class="col-md-4">
      <% if song.image.url %>
  <%= image_tag song.image.url, class:"img-fluid rounded-start" %>
  <%else%>
  <%= image_tag "default_album.png", class:"img-fluid rounded-start", style:"height:15rem;" %>
  <%end%>
  
    </div>
    <div class="col-md-8">
  
    <div class="card-body">
      <h5 class="card-title"><%= song.title %></h5>
        <p class="card-text"><% if song.author %> <%= song.author %><% else %><%= song.user.name %><%end%> </p>
        <% if song.audio.url %> 
        <!--<%= audio_tag(song.audio.url, controls: true, preload: "auto", autobuffer: "", id: song.audio.url)%>-->
        <button type="button" id="<%= song.id %>" class="btn btn-light rounded-circle" onclick="change_music('<%=song.audio.url%>', '<%=song.id%>', 'i<%=song.id%>');"><i id='i<%=song.id%>' class="bi bi-play" style="font-size:2em;"></i></button>
        <script>
  
   function change_music(music, id, idi)
   {
    var elements = document.getElementsByClassName("bi bi-pause");
    var buttons = document.getElementsByClassName("btn btn-light rounded-circle");

    //console.log(document.getElementById(id).getAttribute('onclick'));
    for(var i = buttons.length - 1; i >= 0; --i)
    {
        if(buttons[i].getAttribute('id') == id){
          console.log("peder");
        }
        else{
          console.log("krneki");
          let x = buttons[i].getAttribute("onclick").split("_");
          x[0] = "change";
          var string = x.join("_");
          buttons[i].setAttribute("onclick", string);
        }
        // PERFORM STUFF ON THE ELEMENT
        

        // elements[i] no longer exists past this point, in most browsers
    }  

    for(var i = elements.length - 1; i >= 0; --i)
    {
        
        // PERFORM STUFF ON THE ELEMENT
        elements[i].className = "bi bi-play";
        

        // elements[i] no longer exists past this point, in most browsers
    }  
     if(document.getElementById("main-player").src == music) {
       document.getElementById("main-player").play();
       document.getElementById(id).setAttribute( "onclick", "pause_music('" + music + "', '" + id + "', '" + idi +"')");
       document.getElementById(idi).className = "bi bi-pause";
     }
     else{
       document.getElementById("main-player").pause();
       document.getElementById("main-player").setAttribute('src', music);
       document.getElementById("main-player").load();
       document.getElementById("main-player").play();
       
      sessionStorage.setItem('current_song',music);
      //alert(sessionStorage.getItem('current_song'));

     document.getElementById(id).setAttribute( "onclick", "pause_music('" + music + "', '" + id + "', '" + idi +"')");
     document.getElementById(idi).className = "bi bi-pause";
     }

   }

   function pause_music(music, id, idi) 
   {
     document.getElementById("main-player").pause();
     document.getElementById(id).setAttribute( "onclick", "change_music('" + music + "', '" + id + "', '" + idi +"')");
     document.getElementById(idi).className = "bi bi-play";
   }


</script>
        <% else %>
        No audio
        <%end%> 
        <br />
        <%if user_signed_in? %>
        <% pre_like = song.likes.find { |like| like.user_id == current_user.id} %>
<% if pre_like %>
  <%= link_to '<i class="bi bi-heart-fill"></i>'.html_safe, song_like_path(song.id, pre_like), data: { confirm: "If you do this music will stop :(" }, method: :delete, class:"text-decoration-none", style:"color: white; font-size: 1.5rem;"%>
<% else %>
  <%= link_to '<i class="bi bi-heart"></i>'.html_safe, song_likes_path(song.id), data: { confirm: "If you do this music will stop :(" }, method: :post, class:"text-decoration-none", style:"color: white; font-size: 1.5rem;" %>
<% end %>
<% end %>
<div> 
  </div>
    </div>
        </div>
  <div class="card-footer text-muted d-inline">
  <div class="d-inline">
    <%= song.likes.count %> <%= (song.likes.count) == 1 ? 'Like' : 'Likes'%>
  <script>
document.addEventListener('play', function(e){
    var audios = document.getElementsByTagName('audio');
    for(var i = 0, len = audios.length; i < len;i++){
        if(audios[i] != e.target){
            audios[i].pause();
        }
    }
}, true);
</script> 
</div>
</div>
    </div>
  </div>
  
    <% end %>